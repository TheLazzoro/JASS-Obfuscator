//===========================================================================
// 
// Deadlock [NE] 2.5 [1.31+]
// 
//   Warcraft III map script
//   Generated by the Warcraft III World Editor
//   Map Author: Daffa the Mage
// 
//===========================================================================

//***************************************************************************
//*
//*  Global Variables
//*
//***************************************************************************

globals
    // User-defined
    string                  udg_RevealWarning
    integer array           udg_DayAbility
    integer array           udg_NightAbility
    integer                 udg_PlayerCode             = 0
    player                  udg_PickedPlayer           = null
    boolean array           udg_Tier2
    boolean array           udg_Tier3
    player                  udg_Player                 = null
    boolean array           udg_Supplier
    location                udg_HideSpot               = null
    unit array              udg_SupplierUnit
    unit array              udg_Tier2Unit
    unit array              udg_Tier3Unit
    player                  udg_GetLocalPlayer         = null
    integer                 udg_ut                     = 0
    group                   udg_ug                     = null
    integer                 udg_t                      = 0
    unit                    udg_u                      = null
    location                udg_point                  = null
    integer                 udg_countRes               = 0
    group                   udg_bankGroup              = null

    // Generated
    string                  gg_snd_NightEmpireTheme
    trigger                 gg_trg_Hero_Level          = null
    trigger                 gg_trg_Hero_built          = null
    trigger                 gg_trg_ObserverMode        = null
    trigger                 gg_trg_Melee_Initialization = null
    trigger                 gg_trg_Music               = null
    trigger                 gg_trg_Tier_Up             = null
    trigger                 gg_trg_Tier_Down           = null
    trigger                 gg_trg_Debug               = null
    trigger                 gg_trg_BankAdd             = null
    trigger                 gg_trg_BankRemove          = null
    trigger                 gg_trg_BankInterest        = null
    trigger                 gg_trg_InvisibleMove       = null
    trigger                 gg_trg_AbilityEnable       = null
    trigger                 gg_trg_TowerSpeed          = null
    trigger                 gg_trg_BreezeAura          = null
    trigger                 gg_trg_Reinforcement       = null
    trigger                 gg_trg_NightWalk           = null
    trigger                 gg_trg_BlinkStrike         = null
endglobals

function InitGlobals takes nothing returns nothing
    local integer i = 0
    set udg_RevealWarning = "You will be revealed to your opponents unless you build a town-hall type structure."
    set udg_PlayerCode = 0
    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Tier2[i] = false
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Tier3[i] = false
        set i = i + 1
    endloop

    set i = 0
    loop
        exitwhen (i > 1)
        set udg_Supplier[i] = false
        set i = i + 1
    endloop

    set udg_ug = CreateGroup()
    set udg_countRes = 0
    set udg_bankGroup = CreateGroup()
endfunction

//***************************************************************************
//*
//*  Custom Script Code
//*
//***************************************************************************
//***************************************************************************
//*  Hero Spell Choose
function Skill_Paladin takes unit u, integer level returns nothing
	// HOLY LIGHT
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AHhb' )
	// DEVOTION AURA
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AHad' )
	// DIVINE SHIELD
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AHds' )
	// RESURRECTION
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AHre' )
	endif
endfunction

function Skill_Archmage takes unit u, integer level returns nothing
	// WATER ELEMENTAL
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AHwe' )
	// BRILLIANCE AURA
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AHbz' )
	// BLIZZARD
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AHab' )
	// MASS TELEPORT
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AHmt' )
	endif
endfunction

function Skill_MountainKing takes unit u, integer level returns nothing
	// STORM BOLT
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AHtb' )
	// BASH
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AHbh' )
	// THUNDER CLAP
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AHtc' )
	// AVATAR
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AHav' )
	endif
endfunction

function Skill_Bloodmage takes unit u, integer level returns nothing
	// FLAME STRIKE
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AHfs' )
	// SIPHON MANA
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AHdr' )
	// BANISH
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AHbn' )
	// PHOENIX
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AHpx' )
	endif
endfunction

function Skill_Blademaster takes unit u, integer level returns nothing
	// WINDWALK
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AOwk' )
	// CRITICAL STRIKE
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AOcr' )
	// MIRROR IMAGE
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AOmi' )
	// BLADESTORM
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AOww' )
	endif
endfunction

function Skill_Farseer takes unit u, integer level returns nothing
	// FERAL SPIRIT
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AOsf' )
	// CHAIN LIGHTNING
	elseif (level == 2 or level == 4 or level == 7) then
		call SelectHeroSkill( u, 'AOcl' )
	// FAR SIGHT
	elseif (level == 8 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AOfs' )
	// EARTHQUAKE
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AOeq' )
	endif
endfunction

function Skill_Chieftain takes unit u, integer level returns nothing
	// WARSTOMP
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AOws' )
	// ENDURENCE AURA
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AOae' )
	// SHOCKWAVE
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AOsh' )
	// REINCARNATION
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AOre' )
	endif
endfunction

function Skill_ShadowHunter takes unit u, integer level returns nothing
	// HEALING WAVE
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AOhw' )
	// HEX
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AOhx' )
	// SERPENT WARD
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AOsw' )
	// BIG BAD VODOO
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AOvd' )
	endif
endfunction

function Skill_DeathKnight takes unit u, integer level returns nothing
	// DEATH COIL
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AUdc' )
	// UNHOLY AURA
	elseif (level == 2 or level == 4 or level == 7) then
		call SelectHeroSkill( u, 'AUau' )
	// DEATH PACT
	elseif (level == 8 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AUdp' )
	// ANIMATE DEAD
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AUan' )
	endif
endfunction

function Skill_Lich takes unit u, integer level returns nothing
	// FROST NOVA
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AUfn' )
	// DARK RITUAL
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AUdr' )
	// FROST ARMOR
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AUfu' )
	// DEATH AND DECAY
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AUdd' )
	endif
endfunction

function Skill_Dreadlord takes unit u, integer level returns nothing
	// CARRION SWARM
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AUcs' )
	// VAMPIRIC AURA
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AUav' )
	// SLEEP
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AUsl' )
	// INFERNO
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AUin' )
	endif
endfunction

function Skill_CryptLord takes unit u, integer level returns nothing
	// CARRION BEETLES
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AUcb' )
	// SPIKED CARAPACE
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AUts' )
	// IMPALE
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AUim' )
	// LOCUST SWARM
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AUls' )
	endif
endfunction

function Skill_Priestress takes unit u, integer level returns nothing
	// SEARING ARROW
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AEfa' )
	// TRUESHOT AURA
	elseif (level == 2 or level == 4 or level == 7) then
		call SelectHeroSkill( u, 'AEar' )
	// SCOUT
	elseif (level == 8 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AEst' )
	// STARFALL
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AEsf' )
	endif
endfunction

function Skill_Keeper takes unit u, integer level returns nothing
	// FORCE OF NATURE
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AEfn' )
	// ENTANGLING ROOTS
	elseif (level == 2 or level == 4 or level == 7) then
		call SelectHeroSkill( u, 'AEer' )
	// THORNS AURA
	elseif (level == 8 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AEah' )
	// TRANQUILITY
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AEtq' )
	endif
endfunction

function Skill_DemonHunter takes unit u, integer level returns nothing
	// MANA BURN
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AEmb' )
	// EVASION
	elseif (level == 2 or level == 4 or level == 7) then
		call SelectHeroSkill( u, 'AEev' )
	// IMMOLATION
	elseif (level == 8 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AEim' )
	// METAMORPHOSIS
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AEme' )
	endif
endfunction

function Skill_Warden takes unit u, integer level returns nothing
	// SHADOW STRIKE
	if (level == 1 or level == 3 or level == 5) then
		call SelectHeroSkill( u, 'AEsh' )
	// BLINK
	elseif (level == 2 or level == 4 or level == 8) then
		call SelectHeroSkill( u, 'AEbl' )
	// FAN OF KNIVES
	elseif (level == 7 or level == 9 or level == 10) then
		call SelectHeroSkill( u, 'AEfk' )
	// VENGEANCE
	elseif (level == 6) then
		call SelectHeroSkill( u, 'AEsv' )
	endif
endfunction

////////////////////////////////////////////////////////////////////////////////////////
//
//	Find hero and level
//
////////////////////////////////////////////////////////////////////////////////////////


function Trig_Choose_Hero_Spell_Actions takes unit u returns nothing
	local integer level
	set level = GetHeroLevel(u)
	
	//////////////////////////////
	//	HUMAN
	if (GetUnitRace(u) == RACE_HUMAN) then
	//////////////////////////////
	//	PALADIN
		if (GetUnitTypeId(u) == 'Hpal' ) then
			call Skill_Paladin(u, level)
	//	ARCHMAGE
		elseif (GetUnitTypeId(u) == 'Hamg' ) then
			call Skill_Archmage(u, level)
	//	MOUNTAIN KING
		elseif (GetUnitTypeId(u) == 'Hmkg' ) then
			call Skill_MountainKing(u, level)
	//	BLOODMAGE
		elseif (GetUnitTypeId(u) == 'Hblm' ) then
			call Skill_Bloodmage(u, level)
		endif
	//////////////////////////////
	//	ORC
	elseif (GetUnitRace(u) == RACE_ORC) then
	//////////////////////////////
	//	BLADEMASTER
		if (GetUnitTypeId(u) == 'Obla' ) then
			call Skill_Blademaster(u, level)
	//	FARSEER
		elseif (GetUnitTypeId(u) == 'Ofar' ) then
			call Skill_Farseer(u, level)
	//	TAUREN CHIEFTAIN
		elseif (GetUnitTypeId(u) == 'Otch' ) then
			call Skill_Chieftain(u, level)
	//	SHADOW HUNTER
		elseif (GetUnitTypeId(u) == 'Oshd' ) then
			call Skill_ShadowHunter(u, level)
		endif
	//////////////////////////////
	//	UNDEAD
	elseif (GetUnitRace(u) == RACE_UNDEAD) then
	//////////////////////////////
	// 	DEATH KNIGHT
		if (GetUnitTypeId(u) == 'Udea' ) then
			call Skill_DeathKnight(u, level)
	//	LICH
		elseif (GetUnitTypeId(u) == 'Ulic' ) then
			call Skill_Lich(u, level)
	//	DREADLORD
		elseif (GetUnitTypeId(u) == 'Udre' ) then
			call Skill_Dreadlord(u, level)
	//	CRYPT LORD
		elseif (GetUnitTypeId(u) == 'Ucrl' ) then
			call Skill_CryptLord(u, level)
		endif
	//////////////////////////////
	//	NIGHT ELF
	elseif (GetUnitRace(u) == RACE_NIGHTELF) then
	//////////////////////////////
	//	KEEPER OF THE GROVE
		if (GetUnitTypeId(u) == 'Ekee' ) then
			call Skill_Keeper(u, level)
	//	PRIESTRESS OF THE M
		elseif (GetUnitTypeId(u) == 'Emoo' ) then
			call Skill_Priestress(u, level)
	//	DEMON HUNTER
		elseif (GetUnitTypeId(u) == 'Edem' ) then
			call Skill_DemonHunter(u, level)
	//	WARDEN
		elseif (GetUnitTypeId(u) == 'Ewar' ) then
			call Skill_Warden(u, level)
		endif
	//////////////////////////////
	endif
endfunction

//===========================================================================
//function InitTrig_Choose_Hero_Spell takes nothing returns nothing
//    set gg_trg_Choose_Hero_Spell = CreateTrigger(  )
//    call TriggerAddAction( gg_trg_Choose_Hero_Spell, function Trig_Choose_Hero_Spell_Actions )
//endfunction

//***************************************************************************
//*
//*  Unit Item Tables
//*
//***************************************************************************

function Unit000032_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 4 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000033_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000037_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 4 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000038_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000042_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 4 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000043_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000047_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 4 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000048_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000052_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 4 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000053_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000057_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 4 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000058_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000062_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 4 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000063_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000067_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 4 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000068_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000073_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000076_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000077_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000082_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 3 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000083_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000085_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000087_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000090_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 3 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000092_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000095_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000098_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 3 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000100_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000103_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000106_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 3 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000108_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000111_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000114_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 3 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000116_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000119_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000122_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 3 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000124_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000127_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000130_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 3 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000132_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000135_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000137_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000141_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000144_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000147_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000152_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_CHARGED, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000155_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_CHARGED, 2 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000156_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000158_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000160_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000162_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000164_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000167_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_POWERUP, 1 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction

function Unit000169_DropItems takes nothing returns nothing
    local widget  trigWidget = null
    local unit    trigUnit   = null
    local integer itemID     = 0
    local boolean canDrop    = true

    set trigWidget = bj_lastDyingWidget
    if (trigWidget == null) then
        set trigUnit = GetTriggerUnit()
    endif

    if (trigUnit != null) then
        set canDrop = not IsUnitHidden(trigUnit)
        if (canDrop and GetChangingUnit() != null) then
            set canDrop = (GetChangingUnitPrevOwner() == Player(PLAYER_NEUTRAL_AGGRESSIVE))
        endif
    endif

    if (canDrop) then
        // Item set 0
        call RandomDistReset(  )
        call RandomDistAddItem( ChooseRandomItemEx( ITEM_TYPE_PERMANENT, 3 ), 100 )
        set itemID = RandomDistChoose(  )
        if (trigUnit != null) then
            call UnitDropItem( trigUnit, itemID )
        else
            call WidgetDropItem( trigWidget, itemID )
        endif

    endif

    set bj_lastDyingWidget = null
    call DestroyTrigger(GetTriggeringTrigger())
endfunction


//***************************************************************************
//*
//*  Sound Assets
//*
//***************************************************************************

function InitSounds takes nothing returns nothing
    set gg_snd_NightEmpireTheme = "war3mapImported\\No Copyright Music - Kupers -SAD ANGEL.mp3"
endfunction

//***************************************************************************
//*
//*  Unit Creation
//*
//***************************************************************************

//===========================================================================
function CreateNeutralHostile takes nothing returns nothing
    local player p = Player(PLAYER_NEUTRAL_AGGRESSIVE)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set u = BlzCreateUnitWithSkin( p, 'nowe', -6665.3, -7484.2, 34.180, 'nowe' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000032_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', -6638.7, -7724.0, 44.150, 'ncim' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000033_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', -6856.1, -7369.8, 24.589, 'ncim' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -6503.1, -7579.2, 43.627, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -6663.6, -7279.3, 24.466, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'nowe', 100.4, -8218.9, 75.625, 'nowe' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000037_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', 279.1, -8381.1, 85.595, 'ncim' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000038_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', -118.4, -8259.5, 66.035, 'ncim' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 284.9, -8182.8, 85.072, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -33.9, -8064.3, 65.912, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'nowe', 7428.2, -7411.7, 120.312, 'nowe' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000042_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', 7669.3, -7401.3, 130.282, 'ncim' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000043_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', 7301.2, -7594.4, 110.721, 'ncim' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 7534.0, -7256.3, 129.759, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 7224.0, -7396.2, 110.599, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'nowe', 7990.2, -19.3, 175.769, 'nowe' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000047_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', 8118.3, 185.2, 185.739, 'ncim' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000048_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', 8068.7, -227.5, 166.178, 'ncim' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 7922.1, 155.9, 185.216, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 7861.6, -178.7, 166.055, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'nowe', 7557.4, 7088.9, 230.140, 'nowe' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000052_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', 7466.0, 7312.2, 240.110, 'ncim' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000053_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', 7772.4, 7031.4, 220.550, 'ncim' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 7375.4, 7135.7, 239.587, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 7612.2, 6891.5, 220.427, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'nowe', 322.9, 7757.0, 258.336, 'nowe' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000057_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', 136.8, 7910.6, 268.306, 'ncim' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000058_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', 539.6, 7807.9, 248.745, 'ncim' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 140.4, 7712.2, 267.783, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 464.4, 7608.9, 248.622, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'nowe', -6798.4, 6576.9, 319.794, 'nowe' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000062_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', -7022.2, 6486.8, 329.764, 'ncim' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000063_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', -6739.6, 6791.5, 310.203, 'ncim' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -6846.3, 6395.2, 329.241, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -6600.7, 6630.4, 310.080, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'nowe', -7904.0, -330.5, 319.794, 'nowe' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000067_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', -8127.8, -420.7, 329.764, 'ncim' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000068_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncim', -7845.2, -115.9, 310.203, 'ncim' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -7951.8, -512.3, 329.241, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -7706.3, -277.0, 310.080, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncks', 3429.2, -8304.6, 78.980, 'ncks' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000082_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 3325.0, -8212.2, 65.948, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 3529.4, -8229.6, 95.743, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 3274.1, -8413.5, 46.817, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 3553.5, -8432.4, 98.490, 'ncea' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000076_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 8276.1, -3979.8, 136.817, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 8295.0, -3700.4, 188.490, 'ncea' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000092_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 3419.3, -8446.7, 70.916, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 8309.3, -3834.5, 160.916, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncks', 8167.2, -3824.6, 168.980, 'ncks' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000090_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 8074.8, -3928.8, 155.948, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 8092.2, -3724.4, 185.743, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 8237.3, 3003.5, 136.817, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 8256.1, 3282.9, 188.490, 'ncea' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000100_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 8270.5, 3148.7, 160.916, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncks', 8128.4, 3158.6, 168.980, 'ncks' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000098_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 8035.9, 3054.4, 155.948, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 8053.3, 3258.9, 185.743, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 4088.3, 8069.9, 259.284, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 3809.6, 8043.1, 285.619, 'ncea' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000108_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 3939.6, 8079.1, 273.061, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncks', 3952.9, 7937.3, 272.378, 'ncks' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000106_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 4070.8, 7863.0, 256.354, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 3866.2, 7846.9, 285.374, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -2812.8, 7948.4, 259.284, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -3091.5, 7921.6, 285.619, 'ncea' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000116_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -2961.4, 7957.6, 273.061, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncks', -2948.1, 7815.8, 272.378, 'ncks' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000114_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -2830.3, 7741.5, 256.354, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -3034.9, 7725.5, 285.374, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -7805.9, 3301.7, 349.284, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -7779.2, 3023.0, 15.619, 'ncea' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000124_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -7815.1, 3153.0, 3.061, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncks', -7673.3, 3166.3, 2.378, 'ncks' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000122_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -7599.0, 3284.1, 346.354, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -7583.0, 3079.6, 15.374, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -8242.5, -3915.8, 349.284, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -8215.7, -4194.5, 15.619, 'ncea' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000132_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -8251.6, -4064.4, 3.061, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncks', -8109.8, -4051.1, 2.378, 'ncks' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000130_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -8035.5, -3933.3, 346.354, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -8019.5, -4137.9, 15.374, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -3833.5, -8606.3, 79.284, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -3554.8, -8579.5, 105.619, 'ncea' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000167_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -3684.8, -8615.5, 93.061, 'ncea' )
    set u = BlzCreateUnitWithSkin( p, 'ncks', -3698.1, -8473.6, 92.378, 'ncks' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000169_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -3815.9, -8399.3, 76.354, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -3611.4, -8383.3, 105.374, 'ncer' )
    set u = BlzCreateUnitWithSkin( p, 'nqbh', -1009.5, -2309.6, 38.537, 'nqbh' )
    set u = BlzCreateUnitWithSkin( p, 'nqbh', -604.5, -2482.5, 93.140, 'nqbh' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000137_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'nrzs', -838.5, -2248.8, 49.225, 'nrzs' )
    set u = BlzCreateUnitWithSkin( p, 'nrzs', -707.3, -2328.3, 76.548, 'nrzs' )
    set u = BlzCreateUnitWithSkin( p, 'nqbh', 989.5, 1987.4, 218.537, 'nqbh' )
    set u = BlzCreateUnitWithSkin( p, 'nqbh', 584.5, 2160.4, 273.140, 'nqbh' )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000141_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'nrzs', 818.5, 1926.7, 229.225, 'nrzs' )
    set u = BlzCreateUnitWithSkin( p, 'nrzs', 687.2, 2006.2, 256.548, 'nrzs' )
    set u = BlzCreateUnitWithSkin( p, 'ncks', 5063.1, -3967.4, 120.170, 'ncks' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000144_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 5005.8, -4102.3, 112.153, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 5223.9, -3857.2, 135.064, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncks', -4203.5, 2934.1, 300.170, 'ncks' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000147_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -4146.2, 3069.0, 292.153, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -4364.3, 2823.9, 315.064, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'nltl', -4126.2, -2997.9, 52.102, 'nltl' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'nltl', -3602.0, -3033.7, 120.572, 'nltl' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'nrzm', -3878.3, -2949.2, 81.370, 'nrzm' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000152_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'nltl', 3538.7, 2903.4, 191.286, 'nltl' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'nltl', 3181.4, 3288.6, 258.383, 'nltl' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'nrzm', 3324.8, 3037.8, 223.026, 'nrzm' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000155_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 2109.5, 6026.0, 282.042, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000156_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 1991.7, 5990.5, 316.700, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -3561.9, 3905.9, 43.266, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000158_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -3684.1, 3920.5, 32.686, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 4356.9, 4196.6, 49.476, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000160_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 4240.6, 4236.9, 40.445, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 5166.0, 1058.6, 160.752, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000162_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 5117.2, 906.1, 155.054, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 6780.3, -2343.2, 226.933, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000164_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 6684.0, -2266.7, 241.456, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 5136.0, -6905.9, 114.786, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000135_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 5014.9, -6884.0, 106.831, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 108.3, -3679.7, 298.742, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000127_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 5.5, -3747.3, 313.265, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -1892.8, -6814.3, 147.600, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000119_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -2012.6, -6842.3, 139.189, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -3799.4, -4478.1, 217.926, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000111_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -3895.8, -4401.6, 236.020, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -5035.5, -2641.8, 144.042, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000103_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -5005.0, -2522.6, 149.072, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -1699.0, 454.9, 129.537, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000095_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -1604.3, 533.4, 152.101, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -4989.6, 2556.0, 209.458, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000087_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -5085.9, 2632.6, 225.788, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -184.4, 3111.7, 144.188, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000085_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -120.7, 3217.0, 158.712, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', -1681.7, 5102.0, 226.933, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000083_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', -1778.0, 5178.6, 241.456, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 6555.1, 3996.0, 252.573, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000077_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 6435.1, 4023.4, 267.096, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
    set u = BlzCreateUnitWithSkin( p, 'ncer', 3018.8, -148.6, 349.408, 'ncer' )
    call SetUnitAcquireRange( u, 200.0 )
    set t = CreateTrigger(  )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_DEATH )
    call TriggerRegisterUnitEvent( t, u, EVENT_UNIT_CHANGE_OWNER )
    call TriggerAddAction( t, function Unit000073_DropItems )
    set u = BlzCreateUnitWithSkin( p, 'ncea', 3018.9, -25.6, 339.252, 'ncea' )
    call SetUnitAcquireRange( u, 200.0 )
endfunction

//===========================================================================
function CreateNeutralPassiveBuildings takes nothing returns nothing
    local player p = Player(PLAYER_NEUTRAL_PASSIVE)
    local unit u
    local integer unitID
    local trigger t
    local real life

    set u = BlzCreateUnitWithSkin( p, 'ngol', -7104.0, 6976.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 13000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', -6976.0, -7680.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 13000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 7680.0, -7808.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 13000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 7872.0, 7424.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 13000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 320.0, 8192.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 13000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', -8192.0, 0.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 13000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 0.0, -8640.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 13000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 8384.0, 0.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 13000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', -2944.0, 8128.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 15000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 3328.0, -8704.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 15000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 8448.0, 3072.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 15000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', -8448.0, -4032.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 15000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', -8000.0, 3200.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 15000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', -3712.0, -8832.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 15000 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 8512.0, -3904.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 15000 )
    set u = BlzCreateUnitWithSkin( p, 'ngme', -4416.0, 3136.0, 270.000, 'ngme' )
    set u = BlzCreateUnitWithSkin( p, 'nmr4', 3520.0, 3264.0, 270.000, 'nmr4' )
    call SetUnitColor( u, ConvertPlayerColor(11) )
    set u = BlzCreateUnitWithSkin( p, 'nmr4', -3904.0, -3264.0, 270.000, 'nmr4' )
    call SetUnitColor( u, ConvertPlayerColor(11) )
    set u = BlzCreateUnitWithSkin( p, 'ntav', -2176.0, 1984.0, 270.000, 'ntav' )
    call SetUnitColor( u, ConvertPlayerColor(0) )
    set u = BlzCreateUnitWithSkin( p, 'ntav', 3136.0, -3008.0, 270.000, 'ntav' )
    call SetUnitColor( u, ConvertPlayerColor(0) )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 832.0, 2368.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 17500 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', -896.0, -2624.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 17500 )
    set u = BlzCreateUnitWithSkin( p, 'ngol', 3968.0, 8256.0, 270.000, 'ngol' )
    call SetResourceAmount( u, 15000 )
    set u = BlzCreateUnitWithSkin( p, 'ngme', 5312.0, -4160.0, 270.000, 'ngme' )
endfunction

//===========================================================================
function CreatePlayerBuildings takes nothing returns nothing
endfunction

//===========================================================================
function CreatePlayerUnits takes nothing returns nothing
endfunction

//===========================================================================
function CreateAllUnits takes nothing returns nothing
    call CreateNeutralPassiveBuildings(  )
    call CreatePlayerBuildings(  )
    call CreateNeutralHostile(  )
    call CreatePlayerUnits(  )
endfunction

//***************************************************************************
//*
//*  Custom Script Code
//*
//***************************************************************************
//TESH.scrollpos=84
//TESH.alwaysfold=0

function AAdd takes integer i1, integer i2, integer i3, unit u returns nothing
	if i1 == i2 then
    	    call UnitAddAbilityBJ( i3, u )
    	endif
endfunction

//===========================================================================
// Counts key structures owned by a player and his or her allies, including
// structures currently upgrading or under construction.
//
// Key structures: Town Hall, Great Hall, Tree of Life, Necropolis
//

function LivingPlayerHallsFilter takes nothing returns boolean
    return (IsUnitAliveBJ(GetFilterUnit()) and IsUnitType(GetFilterUnit(),UNIT_TYPE_TOWNHALL))
endfunction

function CountLivingPlayerTownHalls takes player whichPlayer returns integer
    local group g
    local integer matchedCount
    local boolexpr b=Filter(function LivingPlayerHallsFilter)

    set g = CreateGroup()
    call GroupEnumUnitsOfPlayer(g, whichPlayer, b)
    set matchedCount = CountUnitsInGroup(g)
    call DestroyGroup(g)
    call DestroyBoolExpr(b)
    set b=null
    set g=null

    return matchedCount
endfunction

function Custom_MeleeGetAllyKeyStructureCount takes player whichPlayer returns integer
    local integer    playerIndex
    local player     indexPlayer
    local integer    keyStructs

    // Count the number of buildings controlled by all not-yet-defeated co-allies.
    set keyStructs = 0
    set playerIndex = 0
    loop
        set indexPlayer = Player(playerIndex)
        if (PlayersAreCoAllied(whichPlayer, indexPlayer)) then
            set keyStructs = keyStructs + CountLivingPlayerTownHalls(indexPlayer)
        //    set keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "townhall", true, true)
        //    set keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "greathall", true, true)
        //    set keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "treeoflife", true, true)
        //    set keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "necropolis", true, true)
        //    set keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "custom_h030", true, true)
        //    set keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "custom_h01C", true, true)
        //    set keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "custom_h012", true, true)
        //    set keyStructs = keyStructs + GetPlayerTypedUnitCount(indexPlayer, "custom_h013", true, true)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h013',indexPlayer)//Never use group functions for this, just count living units for player. Much better idea.
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h014',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h015',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h01C',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h01E',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h01F',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h012',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h02F',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h02J',indexPlayer)
        //    set keyStructs = keySructs + CountLivingPlayerUnitsOfTypeId('h030',indexPlayer)
			
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h000',indexPlayer)//Non-modded human custom ids
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h00D',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('h00E',indexPlayer)
			
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('o00C',indexPlayer)//Non-modded orc custom ids
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('o00D',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('o00E',indexPlayer)
			
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('e00M',indexPlayer)//Non-modded night elf custom ids
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('e00N',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('e00O',indexPlayer)
			
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('u00C',indexPlayer)//Non-modded undead custom ids
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('u00D',indexPlayer)
        //    set keyStructs = keyStructs + CountLivingPlayerUnitsOfTypeId('u00E',indexPlayer)
        endif
            
        set playerIndex = playerIndex + 1
        exitwhen playerIndex == bj_MAX_PLAYERS
    endloop

    return keyStructs
endfunction







//===========================================================================
function Custom_MeleePlayerIsCrippled takes player whichPlayer returns boolean
    local integer allyStructures    = MeleeGetAllyStructureCount(whichPlayer)
    local integer allyKeyStructures = Custom_MeleeGetAllyKeyStructureCount(whichPlayer)

    // Dead teams are not considered to be crippled.
    return (allyStructures > 0) and (allyKeyStructures <= 0)
endfunction



//===========================================================================
// Test each player to determine if anyone has become crippled.
//
function Custom_MeleeCheckForCrippledPlayers takes nothing returns nothing
    local integer    playerIndex
    local player     indexPlayer
    local force      crippledPlayers = CreateForce()
    local boolean    isNowCrippled
    local race       indexRace

    // The "finish soon" exposure of all players overrides any "crippled" exposure
    if bj_finishSoonAllExposed then
        return
    endif

    // Check each player to see if he or she has been crippled or uncrippled.
    set playerIndex = 0
    loop
        set indexPlayer = Player(playerIndex)
        set isNowCrippled = Custom_MeleePlayerIsCrippled(indexPlayer)

        if (not bj_playerIsCrippled[playerIndex] and isNowCrippled) then

            // Player became crippled; start their cripple timer.
            set bj_playerIsCrippled[playerIndex] = true
            call TimerStart(bj_crippledTimer[playerIndex], bj_MELEE_CRIPPLE_TIMEOUT, false, function MeleeCrippledPlayerTimeout)

            if (GetLocalPlayer() == indexPlayer) then
                // Use only local code (no net traffic) within this block to avoid desyncs.

                // Show the timer window.
                call TimerDialogDisplay(bj_crippledTimerWindows[playerIndex], true)

                // Display a warning message.
                call DisplayTimedTextToPlayer(indexPlayer, 0, 0, bj_MELEE_CRIPPLE_MSG_DURATION, "|cffffcc00"+udg_RevealWarning+"|r")
            endif

        elseif (bj_playerIsCrippled[playerIndex] and not isNowCrippled) then

            // Player became uncrippled; stop their cripple timer.
            set bj_playerIsCrippled[playerIndex] = false
            call PauseTimer(bj_crippledTimer[playerIndex])

            if (GetLocalPlayer() == indexPlayer) then
                // Use only local code (no net traffic) within this block to avoid desyncs.

                // Hide the timer window for this player.
                call TimerDialogDisplay(bj_crippledTimerWindows[playerIndex], false)

                // Display a confirmation message if the player's team is still alive.
                if (MeleeGetAllyStructureCount(indexPlayer) > 0) then
                    if (bj_playerIsExposed[playerIndex]) then
                        call DisplayTimedTextToPlayer(indexPlayer, 0, 0, bj_MELEE_CRIPPLE_MSG_DURATION, GetLocalizedString("CRIPPLE_UNREVEALED"))
                    else
                        call DisplayTimedTextToPlayer(indexPlayer, 0, 0, bj_MELEE_CRIPPLE_MSG_DURATION, GetLocalizedString("CRIPPLE_UNCRIPPLED"))
                    endif
                endif
            endif

            // If the player granted shared vision, deny that vision now.
            call MeleeExposePlayer(indexPlayer, false)

        endif
            
        set playerIndex = playerIndex + 1
        exitwhen playerIndex == bj_MAX_PLAYERS
    endloop
endfunction

//===========================================================================
// Determine if the lost unit should result in any defeats or victories.
//
function Custom_MeleeCheckLostUnit takes unit lostUnit returns nothing
    local player lostUnitOwner = GetOwningPlayer(lostUnit)

    // We only need to check for mortality if this was the last building.
    if (GetPlayerStructureCount(lostUnitOwner, true) <= 0) then
        call MeleeCheckForLosersAndVictors()
    endif

    // Check if the lost unit has crippled or uncrippled the player.
    // (A team with 0 units is dead, and thus considered uncrippled.)
    call Custom_MeleeCheckForCrippledPlayers()
endfunction

//===========================================================================
// Determine if the gained unit should result in any defeats, victories,
// or cripple-status changes.
//
function Custom_MeleeCheckAddedUnit takes unit addedUnit returns nothing
    local player addedUnitOwner = GetOwningPlayer(addedUnit)

    // If the player was crippled, this unit may have uncrippled him/her.
    if (bj_playerIsCrippled[GetPlayerId(addedUnitOwner)]) then
        call Custom_MeleeCheckForCrippledPlayers()
    endif
endfunction

//===========================================================================
function Custom_MeleeTriggerActionConstructCancel takes nothing returns nothing
    call Custom_MeleeCheckLostUnit(GetCancelledStructure())
endfunction

//===========================================================================
function Custom_MeleeTriggerActionUnitDeath takes nothing returns nothing
    if (IsUnitType(GetDyingUnit(), UNIT_TYPE_STRUCTURE)) then
        call Custom_MeleeCheckLostUnit(GetDyingUnit())
    endif
endfunction

//===========================================================================
function Custom_MeleeTriggerActionUnitConstructionStart takes nothing returns nothing
    call Custom_MeleeCheckAddedUnit(GetConstructingStructure())
endfunction

//===========================================================================
function Custom_MeleeTriggerActionAllianceChange takes nothing returns nothing
    call MeleeCheckForLosersAndVictors()
    call Custom_MeleeCheckForCrippledPlayers()
endfunction

//===========================================================================
function MeleeInitVictoryDefeatCustomized takes nothing returns nothing
    local trigger trig
    local integer index
    local player indexPlayer

    // Create a timer window for the "finish soon" timeout period, it has no timer
    // because it is driven by real time (outside of the game state to avoid desyncs)
    set bj_finishSoonTimerDialog = CreateTimerDialog(null)

    // Set a trigger to fire when we receive a "finish soon" game event
    set trig = CreateTrigger()
    call TriggerRegisterGameEvent(trig , EVENT_GAME_TOURNAMENT_FINISH_SOON)
    call TriggerAddAction(trig , function MeleeTriggerTournamentFinishSoon)

    // Set a trigger to fire when we receive a "finish now" game event
    set trig = CreateTrigger()
    call TriggerRegisterGameEvent(trig , EVENT_GAME_TOURNAMENT_FINISH_NOW)
    call TriggerAddAction(trig , function MeleeTriggerTournamentFinishNow)

    // Set up each player's mortality code.
    set index = 0
    loop
        set indexPlayer = Player(index)

        // Make sure this player slot is playing.
        if ( GetPlayerSlotState(indexPlayer) == PLAYER_SLOT_STATE_PLAYING ) then
            set bj_meleeDefeated[index]=false
            set bj_meleeVictoried[index]=false

            // Create a timer and timer window in case the player is crippled.
            set bj_playerIsCrippled[index]=false
            set bj_playerIsExposed[index]=false
            set bj_crippledTimer[index]=CreateTimer()
            set bj_crippledTimerWindows[index]=CreateTimerDialog(bj_crippledTimer[index])
            call TimerDialogSetTitle(bj_crippledTimerWindows[index] , MeleeGetCrippledTimerMessage(indexPlayer))

            // Set a trigger to fire whenever a building is cancelled for this player.
            set trig = CreateTrigger()
            call TriggerRegisterPlayerUnitEvent(trig , indexPlayer , EVENT_PLAYER_UNIT_CONSTRUCT_CANCEL , null)
            call TriggerAddAction(trig , function Custom_MeleeTriggerActionConstructCancel)

            // Set a trigger to fire whenever a unit dies for this player.
            set trig = CreateTrigger()
            call TriggerRegisterPlayerUnitEvent(trig , indexPlayer , EVENT_PLAYER_UNIT_DEATH , null)
            call TriggerAddAction(trig , function Custom_MeleeTriggerActionUnitDeath)

            // Set a trigger to fire whenever a unit begins construction for this player
            set trig = CreateTrigger()
            call TriggerRegisterPlayerUnitEvent(trig , indexPlayer , EVENT_PLAYER_UNIT_CONSTRUCT_START , null)
            call TriggerAddAction(trig , function Custom_MeleeTriggerActionUnitConstructionStart)

            // Set a trigger to fire whenever this player defeats-out
            set trig = CreateTrigger()
            call TriggerRegisterPlayerEvent(trig , indexPlayer , EVENT_PLAYER_DEFEAT)
            call TriggerAddAction(trig , function MeleeTriggerActionPlayerDefeated)

            // Set a trigger to fire whenever this player leaves
            set trig = CreateTrigger()
            call TriggerRegisterPlayerEvent(trig , indexPlayer , EVENT_PLAYER_LEAVE)
            call TriggerAddAction(trig , function MeleeTriggerActionPlayerLeft)

            // Set a trigger to fire whenever this player changes his/her alliances.
            set trig = CreateTrigger()
            call TriggerRegisterPlayerAllianceChange(trig , indexPlayer , ALLIANCE_PASSIVE)
            call TriggerRegisterPlayerStateEvent(trig , indexPlayer , PLAYER_STATE_ALLIED_VICTORY , EQUAL , 1)
            call TriggerAddAction(trig , function Custom_MeleeTriggerActionAllianceChange)
        else
            set bj_meleeDefeated[index]=true
            set bj_meleeVictoried[index]=false

            // Handle leave events for observers
            if ( IsPlayerObserver(indexPlayer) ) then
                // Set a trigger to fire whenever this player leaves
                set trig = CreateTrigger()
                call TriggerRegisterPlayerEvent(trig , indexPlayer , EVENT_PLAYER_LEAVE)
                call TriggerAddAction(trig , function MeleeTriggerActionPlayerLeft)
            endif
        endif

        set index = index + 1
        exitwhen index == bj_MAX_PLAYERS
    endloop

    // Test for victory / defeat at startup, in case the user has already won / lost.
    // Allow for a short time to pass first, so that the map can finish loading.
    call TimerStart(CreateTimer() , 2.0 , false , function Custom_MeleeTriggerActionAllianceChange)
endfunction


//***************************************************************************
//*
//*  Triggers
//*
//***************************************************************************

//===========================================================================
// Trigger: Hero Level
//===========================================================================
function Trig_Hero_Level_Conditions takes nothing returns boolean
    if ( not ( GetPlayerController(GetOwningPlayer(GetTriggerUnit())) == MAP_CONTROL_COMPUTER ) ) then
        return false
    endif
    return true
endfunction

function Trig_Hero_Level_Actions takes nothing returns nothing
    call Trig_Choose_Hero_Spell_Actions(GetTriggerUnit())
endfunction

//===========================================================================
function InitTrig_Hero_Level takes nothing returns nothing
    set gg_trg_Hero_Level = CreateTrigger(  )
    call TriggerAddCondition( gg_trg_Hero_Level, Condition( function Trig_Hero_Level_Conditions ) )
    call TriggerAddAction( gg_trg_Hero_Level, function Trig_Hero_Level_Actions )
endfunction

//===========================================================================
// Trigger: Hero built
//===========================================================================
function Trig_Hero_built_Conditions takes nothing returns boolean
    if ( not ( IsUnitType(GetTrainedUnit(), UNIT_TYPE_HERO) == true ) ) then
        return false
    endif
    if ( not ( GetPlayerController(GetOwningPlayer(GetTrainedUnit())) == MAP_CONTROL_COMPUTER ) ) then
        return false
    endif
    return true
endfunction

function Trig_Hero_built_Actions takes nothing returns nothing
    call TriggerRegisterUnitEvent( gg_trg_Hero_Level, GetTrainedUnit(), EVENT_UNIT_HERO_LEVEL )
    call Trig_Choose_Hero_Spell_Actions(GetTrainedUnit())
endfunction

//===========================================================================
function InitTrig_Hero_built takes nothing returns nothing
    set gg_trg_Hero_built = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_Hero_built, EVENT_PLAYER_UNIT_TRAIN_FINISH )
    call TriggerAddCondition( gg_trg_Hero_built, Condition( function Trig_Hero_built_Conditions ) )
    call TriggerAddAction( gg_trg_Hero_built, function Trig_Hero_built_Actions )
endfunction

//===========================================================================
// Trigger: ObserverMode
//===========================================================================
function Trig_ObserverMode_Func001A takes nothing returns nothing
    call KillUnit( GetEnumUnit() )
endfunction

function Trig_ObserverMode_Func004A takes nothing returns nothing
    call SetPlayerAllianceBJ( GetEnumPlayer(), ALLIANCE_SHARED_ADVANCED_CONTROL, true, Player(0) )
endfunction

function Trig_ObserverMode_Actions takes nothing returns nothing
    call ForGroupBJ( GetUnitsOfPlayerAll(Player(0)), function Trig_ObserverMode_Func001A )
    call FogEnableOff(  )
    call FogMaskEnableOff(  )
    call ForForce( GetPlayersAll(), function Trig_ObserverMode_Func004A )
endfunction

//===========================================================================
function InitTrig_ObserverMode takes nothing returns nothing
    set gg_trg_ObserverMode = CreateTrigger(  )
    call TriggerRegisterPlayerChatEvent( gg_trg_ObserverMode, Player(0), "-observe", true )
    call TriggerAddAction( gg_trg_ObserverMode, function Trig_ObserverMode_Actions )
endfunction

//===========================================================================
// Trigger: Melee Initialization
//
// Default melee game initialization for all players
// Modified by Retera using code extracted from the default Warcraft 3 Melee Game scripts, found at "Scripts\Blizzard.j" in your Warcraft III installation (archived inside war3patch.mpq).
//===========================================================================
function Trig_Melee_Initialization_Func011Func008Func001Func002C takes nothing returns boolean
    if ( not ( GetPlayerController(udg_PickedPlayer) == MAP_CONTROL_COMPUTER ) ) then
        return false
    endif
    if ( not ( GetPlayerHandicapBJ(udg_PickedPlayer) == 90.00 ) ) then
        return false
    endif
    return true
endfunction

function Trig_Melee_Initialization_Func011Func008Func001C takes nothing returns boolean
    if ( ( GetPlayerController(udg_PickedPlayer) == MAP_CONTROL_USER ) ) then
        return true
    endif
    if ( Trig_Melee_Initialization_Func011Func008Func001Func002C() ) then
        return true
    endif
    return false
endfunction

function Trig_Melee_Initialization_Func011Func008Func003Func002C takes nothing returns boolean
    if ( not ( IsUnitType(udg_u, UNIT_TYPE_STRUCTURE) == true ) ) then
        return false
    endif
    return true
endfunction

function Trig_Melee_Initialization_Func011Func008Func003A takes nothing returns nothing
    set udg_u = GetEnumUnit()
    if ( Trig_Melee_Initialization_Func011Func008Func003Func002C() ) then
        call ReplaceUnitBJ( udg_u, 'h002', bj_UNIT_STATE_METHOD_RELATIVE )
    else
        call ReplaceUnitBJ( udg_u, 'h000', bj_UNIT_STATE_METHOD_RELATIVE )
    endif
endfunction

function Trig_Melee_Initialization_Func011Func008Func006Func001C takes nothing returns boolean
    if ( not ( GetAIDifficulty(udg_PickedPlayer) == AI_DIFFICULTY_NEWBIE ) ) then
        return false
    endif
    if ( not ( GetRandomInt(1, 2) == 1 ) ) then
        return false
    endif
    return true
endfunction

function Trig_Melee_Initialization_Func011Func008Func006C takes nothing returns boolean
    if ( not ( GetPlayerController(udg_PickedPlayer) == MAP_CONTROL_COMPUTER ) ) then
        return false
    endif
    return true
endfunction

function Trig_Melee_Initialization_Func011Func008C takes nothing returns boolean
    if ( not Trig_Melee_Initialization_Func011Func008Func001C() ) then
        return false
    endif
    if ( not ( GetPlayerRace(udg_PickedPlayer) == RACE_HUMAN ) ) then
        return false
    endif
    return true
endfunction

function Trig_Melee_Initialization_Func011A takes nothing returns nothing
    set udg_PickedPlayer = GetEnumPlayer()
    call SetPlayerTechMaxAllowedSwap( 'H004', 1, udg_PickedPlayer )
    call SetPlayerTechMaxAllowedSwap( 'H00G', 1, udg_PickedPlayer )
    call SetPlayerTechMaxAllowedSwap( 'E000', 1, udg_PickedPlayer )
    call SetPlayerTechMaxAllowedSwap( 'H00S', 1, udg_PickedPlayer )
    call SetPlayerAbilityAvailableBJ( false, 'A00C', udg_PickedPlayer )
    call SetPlayerAbilityAvailableBJ( false, 'A00N', udg_PickedPlayer )
    if ( Trig_Melee_Initialization_Func011Func008C() ) then
        set udg_ug = GetUnitsOfPlayerAll(udg_PickedPlayer)
        call ForGroupBJ( udg_ug, function Trig_Melee_Initialization_Func011Func008Func003A )
        call DestroyGroup(udg_ug)
        call SetPlayerHandicapBJ( udg_PickedPlayer, 100 )
        if ( Trig_Melee_Initialization_Func011Func008Func006C() ) then
            if ( Trig_Melee_Initialization_Func011Func008Func006Func001C() ) then
                call StartMeleeAI( udg_PickedPlayer, "war3mapImported\\NEAIBlitz.ai" )
            else
                call StartMeleeAI( udg_PickedPlayer, "war3mapImported\\NEAI02.ai" )
            endif
        else
        endif
    else
    endif
endfunction

function Trig_Melee_Initialization_Actions takes nothing returns nothing
    set udg_bankGroup = GetUnitsOfTypeIdAll('h00I')
    set udg_GetLocalPlayer = GetLocalPlayer()
    call MeleeStartingVisibility(  )
    call MeleeStartingHeroLimit(  )
    call MeleeGrantHeroItems(  )
    call MeleeStartingResources(  )
    call MeleeClearExcessUnits(  )
    call MeleeStartingUnits(  )
    call MeleeInitVictoryDefeatCustomized()
    call ForForce( GetPlayersAll(), function Trig_Melee_Initialization_Func011A )
    call MeleeStartingAI(  )
    set udg_HideSpot = GetRectCenter(GetPlayableMapRect())
    // CREDITS
    call CreateQuestBJ( bj_QUESTTYPE_REQ_DISCOVERED, "TRIGSTR_014", "TRIGSTR_015", "ReplaceableTextures\\PassiveButtons\\PASBTNResistantSkin.blp" )
endfunction

//===========================================================================
function InitTrig_Melee_Initialization takes nothing returns nothing
    set gg_trg_Melee_Initialization = CreateTrigger(  )
    call TriggerAddAction( gg_trg_Melee_Initialization, function Trig_Melee_Initialization_Actions )
endfunction

//===========================================================================
// Trigger: Music
//===========================================================================
function Trig_Music_Func001Func002Func002C takes nothing returns boolean
    if ( not ( udg_GetLocalPlayer == udg_PickedPlayer ) ) then
        return false
    endif
    return true
endfunction

function Trig_Music_Func001Func002C takes nothing returns boolean
    if ( not ( GetPlayerController(udg_PickedPlayer) == MAP_CONTROL_USER ) ) then
        return false
    endif
    if ( not ( GetPlayerRace(udg_PickedPlayer) == RACE_HUMAN ) ) then
        return false
    endif
    return true
endfunction

function Trig_Music_Func001A takes nothing returns nothing
    set udg_PickedPlayer = GetEnumPlayer()
    if ( Trig_Music_Func001Func002C() ) then
        if ( Trig_Music_Func001Func002Func002C() ) then
            call EndThematicMusicBJ(  )
            call PlayMusicBJ( gg_snd_NightEmpireTheme )
        else
        endif
    else
    endif
endfunction

function Trig_Music_Actions takes nothing returns nothing
    call ForForce( GetPlayersAll(), function Trig_Music_Func001A )
endfunction

//===========================================================================
function InitTrig_Music takes nothing returns nothing
    set gg_trg_Music = CreateTrigger(  )
    call TriggerRegisterTimerEventSingle( gg_trg_Music, 0.00 )
    call TriggerAddAction( gg_trg_Music, function Trig_Music_Actions )
endfunction

//===========================================================================
// Trigger: Tier Up
//===========================================================================
function Trig_Tier_Up_Conditions takes nothing returns boolean
    if ( not ( GetPlayerRace(GetTriggerPlayer()) == RACE_HUMAN ) ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Up_Func005Func005C takes nothing returns boolean
    if ( ( udg_ut == 'h00I' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h008' ) ) then
        return true
    endif
    return false
endfunction

function Trig_Tier_Up_Func005Func006C takes nothing returns boolean
    if ( ( CountLivingPlayerUnitsOfTypeId('h008', udg_Player) > 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00I', udg_Player) > 0 ) ) then
        return true
    endif
    return false
endfunction

function Trig_Tier_Up_Func005C takes nothing returns boolean
    if ( not ( udg_Supplier[udg_PlayerCode] == false ) ) then
        return false
    endif
    if ( not Trig_Tier_Up_Func005Func005C() ) then
        return false
    endif
    if ( not Trig_Tier_Up_Func005Func006C() ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Up_Func006Func005C takes nothing returns boolean
    if ( ( udg_ut == 'h002' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h009' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h003' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h007' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h00I' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h008' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h00O' ) ) then
        return true
    endif
    return false
endfunction

function Trig_Tier_Up_Func006Func007C takes nothing returns boolean
    if ( ( CountLivingPlayerUnitsOfTypeId('h009', udg_Player) > 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00X', udg_Player) > 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00Y', udg_Player) > 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00W', udg_Player) > 0 ) ) then
        return true
    endif
    return false
endfunction

function Trig_Tier_Up_Func006C takes nothing returns boolean
    if ( not ( udg_Tier2[udg_PlayerCode] == false ) ) then
        return false
    endif
    if ( not Trig_Tier_Up_Func006Func005C() ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h002', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not Trig_Tier_Up_Func006Func007C() ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h003', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h007', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h008', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00I', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00O', udg_Player) > 0 ) ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Up_Func007Func005C takes nothing returns boolean
    if ( ( udg_ut == 'h002' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h009' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h003' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h007' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h00I' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h008' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h00D' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h00A' ) ) then
        return true
    endif
    if ( ( udg_ut == 'h00O' ) ) then
        return true
    endif
    return false
endfunction

function Trig_Tier_Up_Func007Func007C takes nothing returns boolean
    if ( ( CountLivingPlayerUnitsOfTypeId('h009', udg_Player) > 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00X', udg_Player) > 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00Y', udg_Player) > 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00W', udg_Player) > 0 ) ) then
        return true
    endif
    return false
endfunction

function Trig_Tier_Up_Func007C takes nothing returns boolean
    if ( not ( udg_Tier3[udg_PlayerCode] == false ) ) then
        return false
    endif
    if ( not Trig_Tier_Up_Func007Func005C() ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h002', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not Trig_Tier_Up_Func007Func007C() ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h003', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h007', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h008', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00I', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00D', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00A', udg_Player) > 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00O', udg_Player) > 0 ) ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Up_Actions takes nothing returns nothing
    set udg_Player = GetTriggerPlayer()
    set udg_PlayerCode = GetConvertedPlayerId(udg_Player)
    set udg_ut = GetUnitTypeId(GetConstructedStructure())
    if ( Trig_Tier_Up_Func005C() ) then
        set udg_Supplier[udg_PlayerCode] = true
        call CreateNUnitsAtLoc( 1, 'h00N', udg_Player, udg_HideSpot, bj_UNIT_FACING )
        set udg_SupplierUnit[udg_PlayerCode] = GetLastCreatedUnit()
    else
    endif
    if ( Trig_Tier_Up_Func006C() ) then
        set udg_Tier2[udg_PlayerCode] = true
        call CreateNUnitsAtLoc( 1, 'h00L', udg_Player, udg_HideSpot, bj_UNIT_FACING )
        set udg_Tier2Unit[udg_PlayerCode] = GetLastCreatedUnit()
    else
    endif
    if ( Trig_Tier_Up_Func007C() ) then
        set udg_Tier3[udg_PlayerCode] = true
        call CreateNUnitsAtLoc( 1, 'h00M', udg_Player, udg_HideSpot, bj_UNIT_FACING )
        set udg_Tier3Unit[udg_PlayerCode] = GetLastCreatedUnit()
    else
    endif
endfunction

//===========================================================================
function InitTrig_Tier_Up takes nothing returns nothing
    set gg_trg_Tier_Up = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_Tier_Up, EVENT_PLAYER_UNIT_CONSTRUCT_FINISH )
    call TriggerAddCondition( gg_trg_Tier_Up, Condition( function Trig_Tier_Up_Conditions ) )
    call TriggerAddAction( gg_trg_Tier_Up, function Trig_Tier_Up_Actions )
endfunction

//===========================================================================
// Trigger: Tier Down
//===========================================================================
function Trig_Tier_Down_Conditions takes nothing returns boolean
    if ( not ( IsUnitType(GetTriggerUnit(), UNIT_TYPE_STRUCTURE) == true ) ) then
        return false
    endif
    if ( not ( GetPlayerRace(GetTriggerPlayer()) == RACE_HUMAN ) ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Down_Func004C takes nothing returns boolean
    if ( not ( udg_Supplier[udg_PlayerCode] == true ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h008', udg_Player) == 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00I', udg_Player) == 0 ) ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Down_Func005Func001Func004Func002C takes nothing returns boolean
    if ( not ( CountLivingPlayerUnitsOfTypeId('h009', udg_Player) == 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00X', udg_Player) == 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00Y', udg_Player) == 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00W', udg_Player) == 0 ) ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Down_Func005Func001Func004C takes nothing returns boolean
    if ( ( CountLivingPlayerUnitsOfTypeId('h002', udg_Player) == 0 ) ) then
        return true
    endif
    if ( Trig_Tier_Down_Func005Func001Func004Func002C() ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h003', udg_Player) == 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h007', udg_Player) == 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h008', udg_Player) == 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00I', udg_Player) == 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00D', udg_Player) == 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00A', udg_Player) == 0 ) ) then
        return true
    endif
    return false
endfunction

function Trig_Tier_Down_Func005Func001C takes nothing returns boolean
    if ( not ( udg_Tier3[udg_PlayerCode] == true ) ) then
        return false
    endif
    if ( not Trig_Tier_Down_Func005Func001Func004C() ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Down_Func005Func005Func002C takes nothing returns boolean
    if ( not ( CountLivingPlayerUnitsOfTypeId('h009', udg_Player) == 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00X', udg_Player) == 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00Y', udg_Player) == 0 ) ) then
        return false
    endif
    if ( not ( CountLivingPlayerUnitsOfTypeId('h00W', udg_Player) == 0 ) ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Down_Func005Func005C takes nothing returns boolean
    if ( ( CountLivingPlayerUnitsOfTypeId('h002', udg_Player) == 0 ) ) then
        return true
    endif
    if ( Trig_Tier_Down_Func005Func005Func002C() ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h003', udg_Player) == 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h007', udg_Player) == 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h008', udg_Player) == 0 ) ) then
        return true
    endif
    if ( ( CountLivingPlayerUnitsOfTypeId('h00I', udg_Player) == 0 ) ) then
        return true
    endif
    return false
endfunction

function Trig_Tier_Down_Func005C takes nothing returns boolean
    if ( not ( udg_Tier2[udg_PlayerCode] == true ) ) then
        return false
    endif
    if ( not Trig_Tier_Down_Func005Func005C() ) then
        return false
    endif
    return true
endfunction

function Trig_Tier_Down_Actions takes nothing returns nothing
    set udg_Player = GetTriggerPlayer()
    set udg_PlayerCode = GetConvertedPlayerId(udg_Player)
    if ( Trig_Tier_Down_Func004C() ) then
        set udg_Supplier[udg_PlayerCode] = false
        call RemoveUnit( udg_SupplierUnit[udg_PlayerCode] )
    else
    endif
    if ( Trig_Tier_Down_Func005C() ) then
        set udg_Tier2[udg_PlayerCode] = false
        call RemoveUnit( udg_Tier2Unit[udg_PlayerCode] )
    else
        if ( Trig_Tier_Down_Func005Func001C() ) then
            set udg_Tier3[udg_PlayerCode] = false
            call RemoveUnit( udg_Tier3Unit[udg_PlayerCode] )
        else
        endif
    endif
endfunction

//===========================================================================
function InitTrig_Tier_Down takes nothing returns nothing
    set gg_trg_Tier_Down = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_Tier_Down, EVENT_PLAYER_UNIT_DEATH )
    call TriggerAddCondition( gg_trg_Tier_Down, Condition( function Trig_Tier_Down_Conditions ) )
    call TriggerAddAction( gg_trg_Tier_Down, function Trig_Tier_Down_Actions )
endfunction

//===========================================================================
// Trigger: BankAdd
//===========================================================================
function Trig_BankAdd_Conditions takes nothing returns boolean
    if ( not ( GetUnitTypeId(GetTriggerUnit()) == 'h00I' ) ) then
        return false
    endif
    return true
endfunction

function Trig_BankAdd_Actions takes nothing returns nothing
    call GroupAddUnitSimple( GetTriggerUnit(), udg_bankGroup )
endfunction

//===========================================================================
function InitTrig_BankAdd takes nothing returns nothing
    set gg_trg_BankAdd = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_BankAdd, EVENT_PLAYER_UNIT_CONSTRUCT_FINISH )
    call TriggerAddCondition( gg_trg_BankAdd, Condition( function Trig_BankAdd_Conditions ) )
    call TriggerAddAction( gg_trg_BankAdd, function Trig_BankAdd_Actions )
endfunction

//===========================================================================
// Trigger: BankRemove
//===========================================================================
function Trig_BankRemove_Conditions takes nothing returns boolean
    if ( not ( GetUnitTypeId(GetTriggerUnit()) == 'h00I' ) ) then
        return false
    endif
    return true
endfunction

function Trig_BankRemove_Actions takes nothing returns nothing
    call GroupRemoveUnitSimple( GetTriggerUnit(), udg_bankGroup )
endfunction

//===========================================================================
function InitTrig_BankRemove takes nothing returns nothing
    set gg_trg_BankRemove = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_BankRemove, EVENT_PLAYER_UNIT_DEATH )
    call TriggerAddCondition( gg_trg_BankRemove, Condition( function Trig_BankRemove_Conditions ) )
    call TriggerAddAction( gg_trg_BankRemove, function Trig_BankRemove_Actions )
endfunction

//===========================================================================
// Trigger: BankInterest
//===========================================================================
function Trig_BankInterest_Func001A takes nothing returns nothing
    // Gold
    set udg_countRes = ( 1 + ( GetPlayerState(GetOwningPlayer(GetEnumUnit()), PLAYER_STATE_RESOURCE_GOLD) / 100 ) )
    call AdjustPlayerStateBJ( udg_countRes, GetOwningPlayer(GetEnumUnit()), PLAYER_STATE_RESOURCE_GOLD )
    set udg_point = GetUnitLoc(GetEnumUnit())
    call CreateTextTagLocBJ( ( I2S(udg_countRes) + "G" ), udg_point, 64.00, 10, 100.00, 80.00, 0.00, 0 )
    call ShowTextTagForceBJ( true, GetLastCreatedTextTag(), GetPlayersAllies(GetOwningPlayer(GetEnumUnit())) )
    call ShowTextTagForceBJ( false, GetLastCreatedTextTag(), GetPlayersEnemies(GetEnumPlayer()) )
    call SetTextTagPermanentBJ( GetLastCreatedTextTag(), false )
    call SetTextTagLifespanBJ( GetLastCreatedTextTag(), 5 )
    call SetTextTagFadepointBJ( GetLastCreatedTextTag(), 3.00 )
    call SetTextTagVelocityBJ( GetLastCreatedTextTag(), 64, 90 )
    call RemoveLocation(udg_point)
    // Lumber
    set udg_countRes = ( 1 + ( GetPlayerState(GetOwningPlayer(GetEnumUnit()), PLAYER_STATE_RESOURCE_LUMBER) / 100 ) )
    call AdjustPlayerStateBJ( udg_countRes, GetOwningPlayer(GetEnumUnit()), PLAYER_STATE_RESOURCE_LUMBER )
    set udg_point = GetUnitLoc(GetEnumUnit())
    call CreateTextTagLocBJ( ( I2S(udg_countRes) + "G" ), udg_point, 0, 10, 0.00, 90.00, 0.00, 0 )
    call ShowTextTagForceBJ( true, GetLastCreatedTextTag(), GetPlayersAllies(GetOwningPlayer(GetEnumUnit())) )
    call ShowTextTagForceBJ( false, GetLastCreatedTextTag(), GetPlayersEnemies(GetEnumPlayer()) )
    call SetTextTagPermanentBJ( GetLastCreatedTextTag(), false )
    call SetTextTagLifespanBJ( GetLastCreatedTextTag(), 5 )
    call SetTextTagFadepointBJ( GetLastCreatedTextTag(), 3.00 )
    call SetTextTagVelocityBJ( GetLastCreatedTextTag(), 64, 90 )
    call RemoveLocation(udg_point)
endfunction

function Trig_BankInterest_Actions takes nothing returns nothing
    call ForGroupBJ( udg_bankGroup, function Trig_BankInterest_Func001A )
endfunction

//===========================================================================
function InitTrig_BankInterest takes nothing returns nothing
    set gg_trg_BankInterest = CreateTrigger(  )
    call TriggerRegisterTimerEventPeriodic( gg_trg_BankInterest, 60.00 )
    call TriggerAddAction( gg_trg_BankInterest, function Trig_BankInterest_Actions )
endfunction

//===========================================================================
// Trigger: InvisibleMove
//===========================================================================
function Trig_Invisible_Move_Actions takes nothing returns nothing
    local player p = GetTriggerPlayer()
    if GetPlayerTechCountSimple('R009', GetTriggerPlayer()) == 1 then
        call SetPlayerAbilityAvailableBJ( true, 'A00N', p )
        call SetPlayerAbilityAvailableBJ( false, 'A00O', p )
    	if GetPlayerTechCountSimple('R006', p) == 1 then
            call SetPlayerAbilityAvailableBJ( true, 'A00C', p )
            call SetPlayerAbilityAvailableBJ( false, 'A00L', p )
        endif
    endif
    set p = null
endfunction

//===========================================================================
function InitTrig_InvisibleMove takes nothing returns nothing
    set gg_trg_InvisibleMove = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_InvisibleMove, EVENT_PLAYER_UNIT_RESEARCH_FINISH )
    call TriggerAddAction( gg_trg_InvisibleMove, function Trig_Invisible_Move_Actions )
endfunction


//===========================================================================
// Trigger: AbilityEnable
//===========================================================================
function Trig_HeroAbilityEnable_Actions takes nothing returns nothing
    local unit u = GetTriggerUnit()
    local integer a = GetLearnedSkillBJ()
    call AAdd (a,'A01G','A00A',u)
    call AAdd (a,'A00T','AItj',u)
    call AAdd (a,'A00W','A00X',u)
    set u = null
endfunction

//===========================================================================
function InitTrig_AbilityEnable takes nothing returns nothing
    set gg_trg_AbilityEnable = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_AbilityEnable, EVENT_PLAYER_HERO_SKILL )
    call TriggerAddAction( gg_trg_AbilityEnable, function Trig_HeroAbilityEnable_Actions )
endfunction


//===========================================================================
// Trigger: TowerSpeed
//===========================================================================
function Trig_Tower_Speed_Actions takes nothing returns nothing
    local unit u = GetTriggerUnit()
    call AAdd (GetUnitTypeId(u),'h00O','S000',u)
    set u = null
endfunction

//===========================================================================
function InitTrig_TowerSpeed takes nothing returns nothing
    set gg_trg_TowerSpeed = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_TowerSpeed, EVENT_PLAYER_UNIT_CONSTRUCT_FINISH )
    call TriggerAddAction( gg_trg_TowerSpeed, function Trig_Tower_Speed_Actions )
endfunction


//===========================================================================
// Trigger: BreezeAura
//===========================================================================
function Trig_Breeze_Aura_Actions takes nothing returns nothing
    local unit u = GetTriggerUnit()
    if UnitHasBuffBJ(u, 'B005') and IsUnitType(u, UNIT_TYPE_HERO) then
        call AddSpecialEffectTargetUnitBJ( "origin", u, "Abilities\\Spells\\Human\\Heal\\HealTarget.mdl" )
        call DestroyEffectBJ( GetLastCreatedEffectBJ() )
        call SetUnitLifePercentBJ( GetTriggerUnit(), GetUnitLifePercent(u) + 5.00 )
    endif
    set u = null
endfunction

//===========================================================================
function InitTrig_BreezeAura takes nothing returns nothing
    set gg_trg_BreezeAura = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_BreezeAura, EVENT_PLAYER_UNIT_SPELL_EFFECT )
    call TriggerAddAction( gg_trg_BreezeAura, function Trig_Breeze_Aura_Actions )
endfunction


//===========================================================================
// Trigger: Reinforcement
//===========================================================================
function Trig_Reinforcement_Actions takes nothing returns nothing
    local unit u = GetTriggerUnit()
    local integer i = GetUnitTypeId(u)
    if i == 'h00H' or i == 'h005' then
        call UnitRemoveTypeBJ( UNIT_TYPE_SUMMONED, u)
    endif
    set u = null
endfunction

//===========================================================================
function InitTrig_Reinforcement takes nothing returns nothing
    set gg_trg_Reinforcement = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_Reinforcement, GetPlayableMapRect() )
    call TriggerAddAction( gg_trg_Reinforcement, function Trig_Reinforcement_Actions )
endfunction


//===========================================================================
// Trigger: NightWalk
//===========================================================================
function Trig_NightWalk_Conditions takes nothing returns boolean
    if ( not ( UnitHasBuffBJ(GetAttacker(), 'B009') == true ) ) then
        return false
    endif
    return true
endfunction

function Trig_NightWalk_Actions takes nothing returns nothing
    call AddSpecialEffectTargetUnitBJ( "origin", GetTriggerUnit(), "war3mapImported\\Coup de Grace.mdx" )
    call DestroyEffectBJ( GetLastCreatedEffectBJ() )
endfunction

//===========================================================================
function InitTrig_NightWalk takes nothing returns nothing
    set gg_trg_NightWalk = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_NightWalk, EVENT_PLAYER_UNIT_ATTACKED )
    call TriggerAddCondition( gg_trg_NightWalk, Condition( function Trig_NightWalk_Conditions ) )
    call TriggerAddAction( gg_trg_NightWalk, function Trig_NightWalk_Actions )
endfunction

//===========================================================================
// Trigger: BlinkStrike
//===========================================================================
function Trig_BlinkStrike_Conditions takes nothing returns boolean
    if ( not ( GetSpellAbilityId() == 'A00U' ) ) then
        return false
    endif
    return true
endfunction

function Trig_BlinkStrike_Func002Func001C takes nothing returns boolean
    if ( not ( IsUnitEnemy(GetEnumUnit(), GetTriggerPlayer()) == true ) ) then
        return false
    endif
    return true
endfunction

function Trig_BlinkStrike_Func002A takes nothing returns nothing
    if ( Trig_BlinkStrike_Func002Func001C() ) then
        call UnitDamageTargetBJ( GetTriggerUnit(), GetEnumUnit(), 80.00, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_NORMAL )
        call AddSpecialEffectTargetUnitBJ( "origin", GetEnumUnit(), "war3mapImported\\Coup de Grace.mdx" )
        call DestroyEffectBJ( GetLastCreatedEffectBJ() )
    else
    endif
endfunction

function Trig_BlinkStrike_Actions takes nothing returns nothing
    set udg_point = GetUnitLoc(GetTriggerUnit())
    call ForGroupBJ( GetUnitsInRangeOfLocAll(300.00, udg_point), function Trig_BlinkStrike_Func002A )
    call RemoveLocation(udg_point)
endfunction

//===========================================================================
function InitTrig_BlinkStrike takes nothing returns nothing
    set gg_trg_BlinkStrike = CreateTrigger(  )
    call TriggerRegisterAnyUnitEventBJ( gg_trg_BlinkStrike, EVENT_PLAYER_UNIT_SPELL_FINISH )
    call TriggerAddCondition( gg_trg_BlinkStrike, Condition( function Trig_BlinkStrike_Conditions ) )
    call TriggerAddAction( gg_trg_BlinkStrike, function Trig_BlinkStrike_Actions )
endfunction

//===========================================================================
function InitCustomTriggers takes nothing returns nothing
    call InitTrig_Hero_Level(  )
    call InitTrig_Hero_built(  )
    call InitTrig_ObserverMode(  )
    call InitTrig_Melee_Initialization(  )
    call InitTrig_Music(  )
    call InitTrig_Tier_Up(  )
    call InitTrig_Tier_Down(  )
    call InitTrig_BankAdd(  )
    call InitTrig_BankRemove(  )
    call InitTrig_BankInterest(  )
    call InitTrig_InvisibleMove(  )
    call InitTrig_AbilityEnable(  )
    call InitTrig_TowerSpeed(  )
    call InitTrig_BreezeAura(  )
    call InitTrig_Reinforcement(  )
    call InitTrig_NightWalk(  )
    call InitTrig_BlinkStrike(  )
endfunction

//===========================================================================
function RunInitializationTriggers takes nothing returns nothing
    call ConditionalTriggerExecute( gg_trg_Melee_Initialization )
endfunction

//***************************************************************************
//*
//*  Players
//*
//***************************************************************************

function InitCustomPlayerSlots takes nothing returns nothing

    // Player 0
    call SetPlayerStartLocation( Player(0), 0 )
    call SetPlayerColor( Player(0), ConvertPlayerColor(0) )
    call SetPlayerRacePreference( Player(0), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(0), true )
    call SetPlayerController( Player(0), MAP_CONTROL_USER )

    // Player 1
    call SetPlayerStartLocation( Player(1), 1 )
    call SetPlayerColor( Player(1), ConvertPlayerColor(1) )
    call SetPlayerRacePreference( Player(1), RACE_PREF_ORC )
    call SetPlayerRaceSelectable( Player(1), true )
    call SetPlayerController( Player(1), MAP_CONTROL_USER )

    // Player 2
    call SetPlayerStartLocation( Player(2), 2 )
    call SetPlayerColor( Player(2), ConvertPlayerColor(2) )
    call SetPlayerRacePreference( Player(2), RACE_PREF_UNDEAD )
    call SetPlayerRaceSelectable( Player(2), true )
    call SetPlayerController( Player(2), MAP_CONTROL_USER )

    // Player 3
    call SetPlayerStartLocation( Player(3), 3 )
    call SetPlayerColor( Player(3), ConvertPlayerColor(3) )
    call SetPlayerRacePreference( Player(3), RACE_PREF_NIGHTELF )
    call SetPlayerRaceSelectable( Player(3), true )
    call SetPlayerController( Player(3), MAP_CONTROL_USER )

    // Player 4
    call SetPlayerStartLocation( Player(4), 4 )
    call SetPlayerColor( Player(4), ConvertPlayerColor(4) )
    call SetPlayerRacePreference( Player(4), RACE_PREF_HUMAN )
    call SetPlayerRaceSelectable( Player(4), true )
    call SetPlayerController( Player(4), MAP_CONTROL_USER )

    // Player 5
    call SetPlayerStartLocation( Player(5), 5 )
    call SetPlayerColor( Player(5), ConvertPlayerColor(5) )
    call SetPlayerRacePreference( Player(5), RACE_PREF_ORC )
    call SetPlayerRaceSelectable( Player(5), true )
    call SetPlayerController( Player(5), MAP_CONTROL_USER )

    // Player 6
    call SetPlayerStartLocation( Player(6), 6 )
    call SetPlayerColor( Player(6), ConvertPlayerColor(6) )
    call SetPlayerRacePreference( Player(6), RACE_PREF_UNDEAD )
    call SetPlayerRaceSelectable( Player(6), true )
    call SetPlayerController( Player(6), MAP_CONTROL_USER )

    // Player 7
    call SetPlayerStartLocation( Player(7), 7 )
    call SetPlayerColor( Player(7), ConvertPlayerColor(7) )
    call SetPlayerRacePreference( Player(7), RACE_PREF_NIGHTELF )
    call SetPlayerRaceSelectable( Player(7), true )
    call SetPlayerController( Player(7), MAP_CONTROL_USER )

endfunction

function InitCustomTeams takes nothing returns nothing
    // Force: TRIGSTR_013
    call SetPlayerTeam( Player(0), 0 )
    call SetPlayerTeam( Player(1), 0 )
    call SetPlayerTeam( Player(2), 0 )
    call SetPlayerTeam( Player(3), 0 )
    call SetPlayerTeam( Player(4), 0 )
    call SetPlayerTeam( Player(5), 0 )
    call SetPlayerTeam( Player(6), 0 )
    call SetPlayerTeam( Player(7), 0 )

endfunction

function InitAllyPriorities takes nothing returns nothing

    call SetStartLocPrioCount( 0, 2 )
    call SetStartLocPrio( 0, 0, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 0, 1, 7, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 1, 2 )
    call SetStartLocPrio( 1, 0, 4, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 1, 1, 5, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 2, 2 )
    call SetStartLocPrio( 2, 0, 5, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 2, 1, 6, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 3, 2 )
    call SetStartLocPrio( 3, 0, 6, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 3, 1, 7, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 4, 2 )
    call SetStartLocPrio( 4, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 4, 1, 1, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 5, 2 )
    call SetStartLocPrio( 5, 0, 1, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 5, 1, 2, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 6, 2 )
    call SetStartLocPrio( 6, 0, 2, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 6, 1, 3, MAP_LOC_PRIO_HIGH )

    call SetStartLocPrioCount( 7, 2 )
    call SetStartLocPrio( 7, 0, 0, MAP_LOC_PRIO_HIGH )
    call SetStartLocPrio( 7, 1, 3, MAP_LOC_PRIO_HIGH )
endfunction

//***************************************************************************
//*
//*  Main Initialization
//*
//***************************************************************************

//===========================================================================
function main takes nothing returns nothing
    call SetCameraBounds( -9216.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), -9472.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 9216.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 8960.0 - GetCameraMargin(CAMERA_MARGIN_TOP), -9216.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 8960.0 - GetCameraMargin(CAMERA_MARGIN_TOP), 9216.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), -9472.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM) )
    call SetDayNightModels( "Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl", "Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl" )
    call NewSoundEnvironment( "Default" )
    call SetAmbientDaySound( "BarrensDay" )
    call SetAmbientNightSound( "BarrensNight" )
    call SetMapMusic( "Music", true, 0 )
    call InitSounds(  )
    call CreateAllUnits(  )
    call InitBlizzard(  )
    call InitGlobals(  )
    call InitCustomTriggers(  )
    call RunInitializationTriggers(  )

endfunction

//***************************************************************************
//*
//*  Map Configuration
//*
//***************************************************************************

function config takes nothing returns nothing
    call SetMapName( "TRIGSTR_001" )
    call SetMapDescription( "TRIGSTR_003" )
    call SetPlayers( 8 )
    call SetTeams( 8 )
    call SetGamePlacement( MAP_PLACEMENT_TEAMS_TOGETHER )

    call DefineStartLocation( 0, -6592.0, 6400.0 )
    call DefineStartLocation( 1, 7168.0, 7040.0 )
    call DefineStartLocation( 2, 7168.0, -7232.0 )
    call DefineStartLocation( 3, -6272.0, -7296.0 )
    call DefineStartLocation( 4, 384.0, 7424.0 )
    call DefineStartLocation( 5, 7616.0, 0.0 )
    call DefineStartLocation( 6, 192.0, -7872.0 )
    call DefineStartLocation( 7, -7680.0, -640.0 )

    // Player setup
    call InitCustomPlayerSlots(  )
    call SetPlayerSlotAvailable( Player(0), MAP_CONTROL_USER )
    call SetPlayerSlotAvailable( Player(1), MAP_CONTROL_USER )
    call SetPlayerSlotAvailable( Player(2), MAP_CONTROL_USER )
    call SetPlayerSlotAvailable( Player(3), MAP_CONTROL_USER )
    call SetPlayerSlotAvailable( Player(4), MAP_CONTROL_USER )
    call SetPlayerSlotAvailable( Player(5), MAP_CONTROL_USER )
    call SetPlayerSlotAvailable( Player(6), MAP_CONTROL_USER )
    call SetPlayerSlotAvailable( Player(7), MAP_CONTROL_USER )
    call InitGenericPlayerSlots(  )
    call InitAllyPriorities(  )
endfunction

